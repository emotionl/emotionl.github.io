# 异步编程

## 并发（Concurrency）和并行（Parallelism）区别

> 异步和这小节的知识点其实并不是一个概念，但是这两个名词确实是很多人都常会混淆的知识点。其实混淆的原因可能只是两个名词在中文上的相似，在英文上来说完全是不同的单词。
>
> 并发是宏观概念，我分别有任务 A 和任务 B，在一段时间内通过任务间的切换完成了这两个任务，这种情况就可以称之为并发。
>
> 并行是微观概念，假设 CPU 中存在两个核心，那么我就可以同时完成任务 A、B。同时完成多个任务的情况就可以称之为并行。

## 异步进化历程

```javascript
const fs = require("fs");
const packagePath = "./../../package.json";

// 第一阶段 callback
function readFile(path, cb) {
    fs.readFile(path, (err, data) => {
        !err ? cb(null, data) : cb(err);
    });
}

readFile(packagePath, function(err, data) {
    if (!err) {
        data = JSON.parse(data);
        console.log(data.name);
    } else {
        console.log(err);
    }
});

// 第二阶段 利用Promise包装
function readFileProm(path) {
    return new Promise((resolve, reject) => {
        fs.readFile(path, (err, data) => {
            !err ? resolve(data) : reject(err);
        });
    });
}

readFileProm(packagePath)
    .then(res => {
        res = JSON.parse(res);
        console.log(res.name);
    })
    .catch(err => console.log(err));

// 第三阶段 co + Generator
const util = require("util");
const co = require("co");
const readFilePromisify = util.promisify(fs.readFile);

co(function*() {
    let data = yield readFilePromisify(packagePath);
    data = JSON.parse(data);
    console.log(data.name);
});

// 第四阶段 async await
async function init(path) {
    let data = await readFilePromisify(path);
    data = JSON.parse(data);
    console.log(data.name);
}
init(packagePath);
```

## 常用定时器函数
