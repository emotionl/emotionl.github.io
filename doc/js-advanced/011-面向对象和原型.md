# 面向对象和原型

> [深入浅出JS对象原型](/doc/article/017-深入浅出JS对象原型.md)

### 实现一个 new 操作

实现 `new` 的步骤

1. 首先创建一个空对象，这个对象将会作为执行 new 构造函数() 之后，返回的对象实例
2. 将上面创建的空对象的原型（`__proto__`），指向构造函数的 prototype 属性
3. 将这个空对象赋值给构造函数内部的 this，并执行构造函数逻辑
4. 根据构造函数执行逻辑，返回第一步创建的对象或者构造函数的显式返回值

```javascript
function Person(name, age) {
  this.name = name
  this.age = age
}

Person.prototype.printInfo = function () {
  console.log(`my name is ${this.name} and ${this.age} years old.`)
}

const customNew = (...args) => {
  const constructor = args.shift()
  const blankObj = {}
  blankObj.__proto__ = constructor.prototype
  // 以上两步等价于 const blankObj = Object.create(constructor.prototype) 
  constructor.apply(blankObj, args)
  return blankObj
}

const p = customNew(Person, 'Jack', 18)
console.log(p)
```

我们知道，构造函数如果有显式返回值，且返回值为对象类型，那么构造函数返回结果不再是目标实例。

```javascript
function Person(name) {
  this.name = name
  return { ps: 'balabala' }
}
const person = new Person('lucas')
console.log(person)
```

