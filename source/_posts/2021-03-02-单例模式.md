---
title: 单例模式
date: 2021-03-02 00:47:39
tags:
  - 设计模式
---

## 代码实现

```javascript
class Person {
  constructor(name, age) {
    this.name = name
    this.age = age
  }
  getPersonInfo() {
    return `My name is ${this.name}, i\`m ${this.age} years old.`
  }
}

const PersonSingleton = (function () {
  // 使用 IIFE 制造闭包缓存实例 instance
  let instance = null
  return function (name, age) {
    if (instance === null) instance = new Person(name, age)
    return instance
  }
})()

const p1 = new PersonSingleton('Jack', 15)
const p2 = new PersonSingleton('David', 17)
p1 === p2 // true
```

如果把上述过程再进行抽象，我们可以得到一个通用的生成单例的函数。

```javascript
function createSingleton(Con) {
  return (function (Con) {
    let instance = null
    return function (...args) {
      if (instance === null) instance = new Con(...args)
      return instance
    }
  })(Con)
}
```

测试一下

```javascript
class A {
  constructor(param) {
    this.param = param
  }
}

const ASingleton = createSingleton(A)
const a1 = new ASingleton('a1')
const a2 = new ASingleton('a2')
a1 === a2 // true
```

## 优缺点

1. 单例模式在创建后在内存中只存在一个实例，节约了内存开支和实例化时的性能开支，特别是需要重复使用一个创建开销比较大的类时，比起实例不断地销毁和重新实例化，单例能节约更多资源，比如数据库连接；
2. 单例模式可以解决对资源的多重占用，比如写文件操作时，因为只有一个实例，可以避免对一个文件进行同时操作；
3. 只使用一个实例，也可以减小垃圾回收机制 GC（Garbage Collecation） 的压力，表现在浏览器中就是系统卡顿减少，操作更流畅，CPU 资源占用更少；

## 使用场景

1. 当一个类的**实例化过程消耗的资源过多**，可以使用单例模式来避免性能浪费；
2. 当项目中需要一个公共的状态，那么需要使用单例模式来**保证访问一致性**；
