---
title: 单例模式
date: 2021-03-02 00:47:39
tags:
  - 设计模式
---

## 代码实现

```javascript
class Person {
  constructor(name, age) {
    this.name = name
    this.age = age
  }
  getPersonInfo() {
    return `My name is ${this.name}, i\`m ${this.age} years old.`
  }
}

const PersonSingleton = (function () {
  // 使用 IIFE 制造闭包缓存实例 instance
  let instance = null
  return function (name, age) {
    if (instance === null) instance = new Person(name, age)
    return instance
  }
})()

const p1 = new PersonSingleton('Jack', 15)
const p2 = new PersonSingleton('David', 17)
p1 === p2 // true
```

如果把上述过程再进行抽象，我们可以得到一个通用的生成单例的函数。

```javascript
function createSingleton(Con) {
  return (function (Con) {
    let instance = null
    return function (...args) {
      if (instance === null) instance = new Con(...args)
      return instance
    }
  })(Con)
}
```

测试一下

```javascript
class A {
  constructor(param) {
    this.param = param
  }
}

const ASingleton = createSingleton(A)
const a1 = new ASingleton('a1')
const a2 = new ASingleton('a2')
a1 === a2 // true
```

## 优缺点 Todo

## 使用场景 Todo
